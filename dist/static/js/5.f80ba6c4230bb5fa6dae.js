webpackJsonp([5],{"0E0D":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),l=a.n(i),s={name:"document",data:function(){return{openHistory:!1,editFileName:"",clientId:"",serviceId:"",isUsual:"",name:"",loading:!1,tab1_act:1,tab2_act:1,client:"广汽本田",fileHistoryList:[],fileHistoryLoading:!1,client_list:[{value:"广汽本田",label:"广汽本田"},{value:"吉利",label:"吉利"},{value:"沃尔沃",label:"沃尔沃"}],tableData:[],editable:[],pageNum:1,totalnum:0,fileList:[],listProFile:[],uploadUrl:"",dialogFileVisible:!1,editData:"",openTaskVisible:!1}},methods:{handleSizeChange:function(){},handleCurrentChange:function(t){this.pageNum=t;var e={userid:1,pageNum:this.pageNum,pageSize:10,name:""};this.getTaskfilePageList(e)},enterDetail:function(t,e){this.openTaskVisible=!0;var a="?id="+e.taskId;this.$axios.post("/pmbs/api/task/show"+a).then(function(t){console.log(t)})},fileRemove:function(){this.dialogFileVisible=!1},fileUpload:function(){var t={proId:1,taskId:30,updateUserId:128,oldFileId:this.editData.fileId.toString()},e={taskfile:l()(t,this.listProFile[0])};this.$axios.post("/pmbs/api/taskfile/importupdate",e).then(function(t){console.log(t)})},handleExceed:function(t,e){this.$message({message:"只能重新上传一个文件！",type:"warning"})},handleRemove:function(t){for(var e=t.response.data,a=this.listProFile,i=0;i<a.length;i++){a[i].localPath==e.path&&a.splice(i,1)}this.listProFile=a},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleSuccess:function(t,e,a){if(0==t.errcode){var i=t.data,l=this.listProFile,s={fileName:i.fileName,localPath:i.path,suffix:i.fileType};l.push(s),this.listProFile=l}},tab1_change:function(t){this.tab1_act=t},tab2_change:function(t){this.tab2_act=t},searchHandle:function(){var t={userid:1,pageNum:this.pageNum,pageSize:10,name:this.name};this.getTaskfilePageList(t)},tableRowClassName:function(t){var e=t.row,a=t.rowIndex;e.index=a},rowClick:function(t,e,a){this.editable=new Array(this.tableData.length)},cellSave:function(t,e){var a=this;this.$axios.post("/pmbs/api/taskfile/updataTaskFileByFileId",{fileId:e.fileId,fileName:this.editFileName}).then(function(t){e.fileName=a.editFileName,a.editable=new Array(a.tableData.length)})},changeNum:function(t,e){this.editable=new Array(this.tableData.length),this.editable[t]=!0,this.saveItem=this.tableData[t],this.$set(this.editable,t,!0),this.$nextTick(function(){document.getElementsByClassName("editRemarkInput")[0].children[0].focus()}),this.editFileName=e.fileName},upload2:function(t,e){this.fileList=[],this.listProFile=[],this.editData=e,this.dialogFileVisible=!0},download:function(t){var e=t.localPath,a=document.createElement("a");a.download="",a.setAttribute("href","http://218.106.254.122:8083/pmbs/"+e),a.click()},lookHistory:function(t,e){var a=this;this.openHistory=!0;var i=e.proId;this.fileHistoryLoading||(this.fileHistoryLoading=!0,this.$axios.post("/pmbs/api/taskfile/getTaskfileById",{proId:i}).then(function(t){a.fileHistoryLoading=!1,t.data&&0!=t.data.length?a.fileHistoryList=t.data:console.log("暂无数据")}).catch(function(){a.fileHistoryLoading=!1}))},getTaskfilePageList:function(t){this.loading||(this.loading=!0,this.$axios.post("/pmbs/api/taskfile/getTaskfilePageList",t).then(this.getTaskfilePageListSuss))},getTaskfilePageListSuss:function(t){200==t.status&&(this.loading=!1,this.totalnum=t.data.length,this.tableData=t.data)}},mounted:function(){var t={userid:1,pageNum:this.pageNum,pageSize:10,name:""};this.getTaskfilePageList(t);this.uploadUrl="/pmbs/file/upload?upType=0&demandType=0"}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"document"},[a("div",[a("el-row",[a("el-col",{staticClass:"top",attrs:{span:24}},[a("el-col",{attrs:{span:5}},[a("el-col",{staticClass:"title",attrs:{span:4}},[t._v("客户")]),t._v(" "),a("el-col",{attrs:{span:20}},[a("el-select",{attrs:{placeholder:"请选择",size:"small"},model:{value:t.client,callback:function(e){t.client=e},expression:"client"}},t._l(t.client_list,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1),t._v(" "),a("el-col",{staticClass:"tab tab1",attrs:{span:6}},[a("el-button-group",[a("el-button",{class:["1"==t.tab1_act?"act":""],attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.tab1_change(1)}}},[t._v("    官网    ")]),t._v(" "),a("el-button",{class:["2"==t.tab1_act?"act":""],attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.tab1_change(2)}}},[t._v("    口碑    ")]),t._v(" "),a("el-button",{class:["3"==t.tab1_act?"act":""],staticStyle:{"border-left":"0"},attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.tab1_change(3)}}},[t._v("数字营销")])],1)],1),t._v(" "),a("el-col",{staticClass:"tab tab2",attrs:{span:4}},[a("el-button-group",[a("el-button",{class:["1"==t.tab2_act?"act":""],attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.tab2_change(1)}}},[t._v("    专项    ")]),t._v(" "),a("el-button",{class:["2"==t.tab2_act?"act":""],attrs:{type:"primary",plain:"",size:"small"},on:{click:function(e){return t.tab2_change(2)}}},[t._v("    日常    ")])],1)],1),t._v(" "),a("el-col",{staticClass:"tab tab3",attrs:{span:8}},[a("el-input",{staticClass:"sousuo",attrs:{placeholder:"搜索",size:"small"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}},[a("el-button",{attrs:{slot:"append",size:"small",icon:"el-icon-search"},on:{click:t.searchHandle},slot:"append"})],1)],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"table-main"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,"default-sort":{prop:"date",order:"descending"},"row-class-name":t.tableRowClassName,"header-cell-style":{background:"rgb(236, 235, 235)",color:"#000"},"row-style":{height:"57px"}},on:{"row-click":t.rowClick}},[a("el-table-column",{attrs:{label:"文档"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{on:{click:function(a){return a.stopPropagation(),t.changeNum(e.$index,e.row)}}},[t.editable[e.$index]?a("div",[a("el-input",{staticClass:"editRemarkInput",attrs:{size:"mini"},model:{value:t.editFileName,callback:function(e){t.editFileName=e},expression:"editFileName"}},[a("el-button",{attrs:{slot:"append",type:"primary",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.cellSave(e.$index,e.row)}},slot:"append"},[t._v("确认")])],1)],1):a("div",[a("i",{staticClass:"el-icon-folder"}),t._v(" "),a("span",[t._v(t._s(e.row.fileName))])])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"clientName",label:"客户"}}),t._v(" "),a("el-table-column",{attrs:{prop:"proName",label:"项目"}}),t._v(" "),a("el-table-column",{attrs:{prop:"taskName",label:"任务"}}),t._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"更新时间",sortable:"",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"realName",label:"更新人",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",icon:"el-icon-upload2"},on:{click:function(a){return t.upload2(e.$index,e.row)}}}),t._v(" "),a("el-button",{attrs:{size:"mini",icon:"el-icon-download"},on:{click:function(a){return t.download(e.row)}}}),t._v(" "),a("el-button",{attrs:{size:"mini",icon:"el-icon-share"},on:{click:function(a){return t.enterDetail(e.$index,e.row)}}}),t._v(" "),a("el-button",{attrs:{size:"mini",icon:"el-icon-time"},on:{click:function(a){return t.lookHistory(e.$index,e.row)}}})]}}])})],1),t._v(" "),a("div",{staticClass:"paging"},[a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"current-page":t.pageNum,layout:"total, prev, pager, next, jumper",total:t.totalnum,background:""},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)])],1),t._v(" "),a("el-drawer",{attrs:{title:"历史文档",visible:t.openHistory,"with-header":!1},on:{"update:visible":function(e){t.openHistory=e}}},[a("el-scrollbar",[a("div",{staticClass:"history-main"},[a("div",{staticClass:"title"},[t._v("历史")]),t._v(" "),a("el-timeline",{directives:[{name:"loading",rawName:"v-loading",value:t.fileHistoryLoading,expression:"fileHistoryLoading"}]},t._l(t.fileHistoryList,function(e){return a("el-timeline-item",{key:e.fileId,attrs:{timestamp:e.updateTime,placement:"top"}},[a("el-card",[a("h4",[t._v("更新人："+t._s(e.realName))]),t._v(" "),a("p",{staticClass:"fileName"},[a("i",{staticClass:"el-icon-folder"}),t._v(" "),a("span",[t._v(t._s(e.fileName))])]),t._v(" "),a("p",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){return t.download(e)}}},[t._v("下载"),a("i",{staticClass:"el-icon-download el-icon--right"})])],1)])],1)}),1),t._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:0==t.fileHistoryList.length,expression:"fileHistoryList.length==0"}]},[t._v("暂无历史数据")])],1)])],1),t._v(" "),a("el-drawer",{attrs:{title:"任务详情",visible:t.openTaskVisible,"with-header":!1},on:{"update:visible":function(e){t.openTaskVisible=e}}},[a("el-scrollbar",[a("div",{staticClass:"history-main"})])],1),t._v(" "),a("el-dialog",{attrs:{title:"修改附件",visible:t.dialogFileVisible},on:{"update:visible":function(e){t.dialogFileVisible=e}}},[a("div",[a("el-upload",{attrs:{action:t.uploadUrl,"list-type":"picture-card","on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove,"on-success":t.handleSuccess,"file-list":t.fileList,limit:1,"on-exceed":t.handleExceed}},[a("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.fileRemove}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.fileUpload}},[t._v("确 定")])],1)])],1)},staticRenderFns:[]};var o=a("VU/8")(s,n,!1,function(t){a("Eeb5")},"data-v-59207504",null);e.default=o.exports},Eeb5:function(t,e){}});